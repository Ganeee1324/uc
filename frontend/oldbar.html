<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Bar Component</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons&display=swap">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200');

        /* Reset & Foundation */
        *,
        *::before,
        *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        .material-symbols-outlined {
            font-family: 'Material Symbols Outlined', 'Material Icons', -apple-system, BlinkMacSystemFont, sans-serif;
            font-weight: normal;
            font-style: normal;
            font-size: 24px;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            -webkit-font-feature-settings: 'liga';
            font-feature-settings: 'liga';
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
            min-width: 1em;
            min-height: 1em;
            text-align: center;
            vertical-align: middle;
        }

        .material-symbols-outlined {
            opacity: 1;
        }

        .material-symbols-outlined:not([style*="font-family"]) {
            font-family: 'Material Icons', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        /* Design System */
        :root {
            --white: #ffffff;
            --white-soft: #fefefe;
            --white-warm: #fdfdfd;
            --gray-50: #fafbfc;
            --gray-100: #f4f6f8;
            --gray-150: #f1f3f5;
            --gray-200: #e9ecef;
            --gray-300: #dee2e6;
            --gray-400: #ced4da;
            --gray-500: #adb5bd;
            --gray-600: #6c757d;
            --gray-700: #495057;
            --gray-800: #343a40;
            --gray-900: #212529;
            --black: #000000;
            
            --blue-50: #f0f9ff;
            --blue-500: #0ea5e9;
            --blue-600: #0284c7;
            --blue-700: #0369a1;
            --green-500: #10b981;
            --green-600: #059669;
            --red-500: #ef4444;
            --orange-500: #f97316;
            --purple-500: #8b5cf6;
            --purple-600: #7c3aed;
            --indigo-500: #6366f1;
            --indigo-600: #4f46e5;
            
            --gradient-primary: linear-gradient(135deg, var(--blue-600) 0%, var(--purple-600) 100%);
            --gradient-secondary: linear-gradient(135deg, var(--indigo-500) 0%, var(--purple-500) 100%);
            --gradient-accent: linear-gradient(135deg, var(--orange-500) 0%, var(--red-500) 100%);
            
            --shadow-xs: 0 1px 2px 0 rgba(0, 0, 0, 0.02);
            --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.08), 0 1px 2px 0 rgba(0, 0, 0, 0.02);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.06), 0 2px 4px -1px rgba(0, 0, 0, 0.04);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.08), 0 4px 6px -2px rgba(0, 0, 0, 0.03);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
            --shadow-luxury: 0 32px 64px -12px rgba(0, 0, 0, 0.12), 0 8px 16px -4px rgba(0, 0, 0, 0.05);
            --shadow-glow: 0 0 40px rgba(99, 102, 241, 0.15);
            
            --radius-xs: 4px;
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --radius-2xl: 20px;
            --radius-3xl: 24px;
            --radius-4xl: 32px;
            --radius-full: 9999px;
            
            --ease-1: cubic-bezier(0.25, 0.46, 0.45, 0.94);
            --ease-2: cubic-bezier(0.165, 0.84, 0.44, 1);
            --ease-3: cubic-bezier(0.19, 1, 0.22, 1);
            --ease-4: cubic-bezier(0.23, 1, 0.32, 1);
            --ease-bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);
            --ease-spring: cubic-bezier(0.175, 0.885, 0.32, 1.275);
            
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-5: 1.25rem;
            --space-6: 1.5rem;
            --space-8: 2rem;
            --space-10: 2.5rem;
            --space-12: 3rem;
            --space-16: 4rem;
            --space-20: 5rem;
        }

        /* Base Styles */
        html {
            scroll-behavior: smooth;
            font-size: 16px;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(to right, #9ddafd, #84d0fc, #9ddafd);
            color: var(--gray-900);
            line-height: 1.6;
            min-height: 100vh;
            height: 100%;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            font-feature-settings: 'kern' 1, 'liga' 1, 'calt' 1, 'ss01' 1;
            letter-spacing: -0.011em;
            overflow-x: hidden;
            position: relative;
        }

        /* Search Section Styles */
        .search-section {
            padding: var(--space-20) var(--space-8) var(--space-16);
            text-align: center;
            position: relative;
            z-index: 10;
            transition: all 0.3s var(--ease-2);
        }

        .search-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: clamp(2.5rem, 5vw, 4rem);
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--space-4);
            letter-spacing: -0.02em;
            line-height: 1.1;
        }

        .search-subtitle {
            font-size: clamp(1.125rem, 2.5vw, 1.5rem);
            color: var(--gray-600);
            margin-bottom: var(--space-12);
            font-weight: 400;
            letter-spacing: -0.01em;
        }

        .search-container-wrapper {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            z-index: 20;
            transition: all 0.3s var(--ease-2);
        }

        .search-container-wrapper.is-stuck {
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 800px;
            z-index: 1000;
            padding: var(--space-4);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--gray-200);
        }

        .search-container {
            display: flex;
            align-items: center;
            gap: var(--space-4);
            background: var(--white);
            border-radius: var(--radius-2xl);
            padding: var(--space-2);
            box-shadow: var(--shadow-xl);
            position: relative;
            z-index: 10;
        }

        /* Search Bar Container with Animated Borders */
        .search-bar-container {
            position: relative;
            flex: 1;
            border-radius: var(--radius-xl);
            overflow: hidden;
            background: var(--white);
            z-index: 1;
        }

        .search-bar-container .glow,
        .search-bar-container .darkBorderBg,
        .search-bar-container .white,
        .search-bar-container .border {
            position: absolute;
            inset: 0;
            border-radius: var(--radius-xl);
            pointer-events: none;
        }

        .search-bar-container .white {
            background: var(--white);
            z-index: 2;
            margin: 2px;
            border-radius: calc(var(--radius-xl) - 2px);
        }

        .search-bar-container .white::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: calc(var(--radius-xl) - 2px);
            background: conic-gradient(
                transparent 0%,
                #a099d8,
                transparent 8%,
                transparent 50%,
                #dfa2da,
                transparent 58%
            );
            opacity: 0;
            transition: opacity 0.3s var(--ease-2);
            filter: brightness(1.4);
        }

        .search-bar-container .border {
            background: var(--white);
            z-index: 1;
            margin: 1px;
            border-radius: calc(var(--radius-xl) - 1px);
        }

        .search-bar-container .border::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: calc(var(--radius-xl) - 1px);
            background: conic-gradient(
                transparent,
                #402fb5 5%,
                transparent 14%,
                transparent 50%,
                #cf30aa 60%,
                transparent 64%
            );
            opacity: 0;
            transition: opacity 0.3s var(--ease-2);
        }

        .search-bar-container .darkBorderBg {
            background: var(--white);
            z-index: 0;
        }

        .search-bar-container .darkBorderBg::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: var(--radius-xl);
            background: conic-gradient(
                transparent,
                #18116a,
                transparent 10%,
                transparent 50%,
                #6e1b60,
                transparent 60%
            );
            opacity: 0;
            transition: opacity 0.3s var(--ease-2);
        }

        .search-bar-container .glow {
            background: var(--white);
            z-index: 3;
            margin: 3px;
            border-radius: calc(var(--radius-xl) - 3px);
        }

        .search-bar-container .glow:before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: calc(var(--radius-xl) - 3px);
            background: conic-gradient(
                transparent,
                #402fb5 5%,
                transparent 38%,
                transparent 50%,
                #cf30aa 60%,
                transparent 87%
            );
            opacity: 0;
            transition: opacity 0.3s var(--ease-2);
        }

        /* Hover Effects */
        .search-bar-container:hover > .darkBorderBg::before {
            opacity: 1;
        }

        .search-bar-container:hover > .glow::before {
            opacity: 0.3;
        }

        .search-bar-container:hover > .white::before {
            opacity: 0.5;
        }

        .search-bar-container:hover > .border::before {
            opacity: 0.7;
        }

        /* Focus Effects */
        .search-bar-container:focus-within > .darkBorderBg::before {
            opacity: 1;
        }

        .search-bar-container:focus-within > .glow::before {
            opacity: 0.4;
        }

        .search-bar-container:focus-within > .white::before {
            opacity: 0.6;
        }

        .search-bar-container:focus-within > .border::before {
            opacity: 0.8;
        }

        /* Search Bar */
        .search-bar {
            position: relative;
            display: flex;
            align-items: center;
            background: var(--white);
            border-radius: var(--radius-xl);
            padding: var(--space-4) var(--space-6);
            transition: all 0.3s var(--ease-2);
            z-index: 4;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .search-bar::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: conic-gradient(from 0deg, transparent, #6366f1, transparent);
            border-radius: var(--radius-xl);
            opacity: 0;
            transition: opacity 0.3s var(--ease-2);
            z-index: -1;
        }

        .search-bar:hover {
            transform: translateY(-1px);
        }

        .search-bar:hover::before {
            opacity: 0.3;
        }

        .search-bar:focus-within {
            transform: translateY(-2px);
            box-shadow: var(--shadow-2xl);
        }

        /* Search Input */
        .search-input {
            flex: 1;
            border: none;
            outline: none;
            background: transparent;
            font-size: 1.125rem;
            color: var(--gray-900);
            font-family: inherit;
            padding: 0;
            margin-right: var(--space-4);
        }

        .search-input:focus {
            outline: none;
        }

        .search-input::placeholder {
            color: var(--gray-500);
            font-weight: 400;
        }

        /* AI Search Toggle */
        .toggle-input {
            display: none;
        }

        .toggle-label {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
            background: var(--gray-100);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all 0.3s var(--ease-2);
            overflow: hidden;
            z-index: 5;
        }

        .toggle-label::after {
            content: '';
            position: absolute;
            inset: 0;
            background: conic-gradient(
                transparent 0%,
                #a099d8,
                transparent 8%,
                transparent 50%,
                #dfa2da,
                transparent 58%
            );
            opacity: 0;
            transition: opacity 0.3s var(--ease-2);
            border-radius: var(--radius-lg);
        }

        .toggle-label .cont-icon {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            z-index: 2;
        }

        .cont-icon {
            position: relative;
        }

        .cont-icon .sparkle {
            position: absolute;
            width: calc(var(--width) * 4px);
            height: calc(var(--width) * 4px);
            background: #6366f1;
            border-radius: 50%;
            animation: sparkle var(--duration) linear infinite;
            transform: rotate(calc(var(--deg) * 1deg));
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0) rotate(calc(var(--deg) * 1deg)); }
            50% { opacity: 1; transform: scale(1) rotate(calc(var(--deg) * 1deg)); }
        }

        .cont-icon .icon {
            width: 24px;
            height: 24px;
            fill: #6366f1;
            transition: all 0.3s var(--ease-2);
        }

        .toggle-input:checked + .toggle-label {
            background: var(--gradient-primary);
            transform: scale(1.05);
        }

        .toggle-input:checked + .toggle-label::before {
            opacity: 1;
        }

        .toggle-input:checked + .toggle-label::after {
            opacity: 0.3;
        }

        .toggle-input:checked + .toggle-label .cont-icon {
            transform: scale(1.1);
        }

        .toggle-input:checked + .toggle-label .cont-icon .sparkle {
            animation-duration: calc(var(--duration) * 0.5s);
        }

        .search-bar .toggle-label {
            margin-left: var(--space-2);
            flex-shrink: 0;
        }

        .search-bar .search-input {
            flex: 1;
            min-width: 0;
        }

        /* Filters Button */
        .filters-btn {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            background: var(--white);
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-xl);
            padding: var(--space-4) var(--space-6);
            font-size: 1rem;
            font-weight: 500;
            color: var(--gray-700);
            cursor: pointer;
            transition: all 0.3s var(--ease-2);
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }

        .filters-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s var(--ease-2);
        }

        .filters-btn:hover {
            border-color: var(--blue-500);
            color: var(--blue-600);
            transform: translateY(-1px);
        }

        .filters-btn:hover::before {
            left: 100%;
        }

        .filters-btn .material-symbols-outlined {
            font-size: 1.25rem;
            transition: transform 0.3s var(--ease-spring);
        }

        .filters-text {
            font-weight: 500;
            transition: color 0.3s var(--ease-2);
        }

        .filter-count {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 20px;
            height: 20px;
            background: var(--gray-200);
            color: var(--gray-600);
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0 var(--space-1);
            transition: all 0.3s var(--ease-spring);
            opacity: 0;
            transform: scale(0.8);
        }

        .filter-count.active {
            background: var(--blue-500);
            color: var(--white);
            opacity: 1;
            transform: scale(1);
        }

        @keyframes filterCountPop {
            0% { transform: scale(0.8); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .search-container {
                flex-direction: column;
                gap: var(--space-3);
            }

            .search-bar {
                width: 100%;
            }

            .filters-btn {
                width: 100%;
                justify-content: center;
            }

            .toggle-label {
                width: 44px;
                height: 44px;
            }

            .toggle-label .cont-icon {
                transform: scale(0.9);
            }
        }

        @media (max-width: 480px) {
            .toggle-label {
                width: 40px;
                height: 40px;
            }

            .toggle-label .cont-icon {
                transform: scale(0.8);
            }
        }

        /* Demo Content */
        .demo-content {
            padding: var(--space-8);
            text-align: center;
        }

        .demo-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--space-4);
        }

        .demo-description {
            font-size: 1.125rem;
            color: var(--gray-600);
            margin-bottom: var(--space-8);
        }
    </style>
</head>
<body>
    <div class="demo-content">
        <h1 class="demo-title">Search Bar Component</h1>
        <p class="demo-description">Complete search bar with animated borders and AI toggle</p>
    </div>

    <!-- Search Section -->
    <div class="search-section">
        <div class="search-container-wrapper">
            <div class="search-container">
                <div class="search-bar-container">
                    <div class="glow"></div>
                    <div class="darkBorderBg"></div>
                    <div class="white"></div>
                    <div class="border"></div>
                    
                    <div class="search-bar">
                        <input type="text" class="search-input" id="searchInput" placeholder="Cerca una dispensa...">
                        <input class="toggle-input" id="toggle" name="toggle" type="checkbox" />
                        <label class="toggle-label" for="toggle" id="aiSearchToggle">
                          <div class="cont-icon">
                            <span
                              style="--width: 2; --deg: 25; --duration: 11"
                              class="sparkle"
                            ></span>
                            <span
                              style="--width: 1; --deg: 100; --duration: 18"
                              class="sparkle"
                            ></span>
                            <span
                              style="--width: 1; --deg: 280; --duration: 5"
                              class="sparkle"
                            ></span>
                            <span
                              style="--width: 2; --deg: 200; --duration: 3"
                              class="sparkle"
                            ></span>
                            <span
                              style="--width: 2; --deg: 30; --duration: 20"
                              class="sparkle"
                            ></span>
                            <span
                              style="--width: 2; --deg: 300; --duration: 9"
                              class="sparkle"
                            ></span>
                            <span
                              style="--width: 1; --deg: 250; --duration: 4"
                              class="sparkle"
                            ></span>
                            <span
                              style="--width: 2; --deg: 210; --duration: 8"
                              class="sparkle"
                            ></span>
                            <span
                              style="--width: 2; --deg: 100; --duration: 9"
                              class="sparkle"
                            ></span>
                            <span
                              style="--width: 1; --deg: 15; --duration: 13"
                              class="sparkle"
                            ></span>
                            <span
                              style="--width: 1; --deg: 75; --duration: 18"
                              class="sparkle"
                            ></span>
                            <span style="--width: 2; --deg: 65; --duration: 6" class="sparkle"></span>
                            <span style="--width: 2; --deg: 50; --duration: 7" class="sparkle"></span>
                            <span
                              style="--width: 1; --deg: 320; --duration: 5"
                              class="sparkle"
                            ></span>
                            <span
                              style="--width: 1; --deg: 220; --duration: 5"
                              class="sparkle"
                            ></span>
                            <span
                              style="--width: 1; --deg: 215; --duration: 2"
                              class="sparkle"
                            ></span>
                            <span
                              style="--width: 2; --deg: 135; --duration: 9"
                              class="sparkle"
                            ></span>
                            <span style="--width: 2; --deg: 45; --duration: 4" class="sparkle"></span>
                            <span
                              style="--width: 1; --deg: 78; --duration: 16"
                              class="sparkle"
                            ></span>
                            <span
                              style="--width: 1; --deg: 89; --duration: 19"
                              class="sparkle"
                            ></span>
                            <span
                              style="--width: 2; --deg: 65; --duration: 14"
                              class="sparkle"
                            ></span>
                            <span style="--width: 2; --deg: 97; --duration: 1" class="sparkle"></span>
                            <span
                              style="--width: 1; --deg: 174; --duration: 10"
                              class="sparkle"
                            ></span>
                            <span
                              style="--width: 1; --deg: 236; --duration: 5"
                              class="sparkle"
                            ></span>
                            <svg
                              xmlns="http://www.w3.org/2000/svg"
                              fill="none"
                              viewBox="0 0 30 30"
                              class="icon"
                            >
                              <path
                                d="M0.96233 28.61C1.36043 29.0081 1.96007 29.1255 2.47555 28.8971L10.4256 25.3552C13.2236 24.11 16.4254 24.1425 19.2107 25.4401L27.4152 29.2747C27.476 29.3044 27.5418 29.3023 27.6047 29.32C27.6563 29.3348 27.7079 29.3497 27.761 29.3574C27.843 29.3687 27.9194 29.3758 28 29.3688C28.1273 29.3617 28.2531 29.3405 28.3726 29.2945C28.4447 29.262 28.5162 29.2287 28.5749 29.1842C28.6399 29.1446 28.6993 29.0994 28.7509 29.0477L28.9008 28.8582C28.9468 28.7995 28.9793 28.7274 29.0112 28.656C29.0599 28.5322 29.0811 28.4036 29.0882 28.2734C29.0939 28.1957 29.0868 28.1207 29.0769 28.0415C29.0705 27.9955 29.0585 27.9524 29.0472 27.9072C29.0295 27.8343 29.0302 27.7601 28.9984 27.6901L25.1638 19.4855C23.8592 16.7073 23.8273 13.5048 25.0726 10.7068L28.6145 2.75679C28.8429 2.24131 28.7318 1.63531 28.3337 1.2372C27.9165 0.820011 27.271 0.721743 26.7491 0.9961L19.8357 4.59596C16.8418 6.15442 13.2879 6.18696 10.2615 4.70062L1.80308 0.520214C1.7055 0.474959 1.60722 0.441742 1.50964 0.421943C1.44459 0.409215 1.37882 0.395769 1.3074 0.402133C1.14406 0.395769 0.981436 0.428275 0.818095 0.499692C0.77284 0.519491 0.719805 0.545671 0.67455 0.578198C0.596061 0.617088 0.524653 0.675786 0.4596 0.74084C0.394546 0.805894 0.335843 0.877306 0.296245 0.956502C0.263718 1.00176 0.237561 1.05477 0.217762 1.10003C0.152708 1.24286 0.126545 1.40058 0.120181 1.54978C0.120181 1.61483 0.126527 1.6735 0.132891 1.73219C0.15269 1.85664 0.178881 1.97332 0.237571 2.08434L4.41798 10.5427C5.91139 13.5621 5.8725 17.1238 4.3204 20.1099L0.720514 27.0233C0.440499 27.5536 0.545137 28.1928 0.96233 28.61Z"
                              ></path>
                            </svg>
                          </div>
                        </label>
                    </div>
                </div>
                <button class="filters-btn" id="filtersBtn">
                    <i class="material-symbols-outlined">tune</i>
                    <span class="filters-text">Filtri</span>
                    <span class="filter-count" id="filterCount">0</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // AI Search Toggle Functionality
        function initializeAISearchToggle() {
            const toggle = document.getElementById('toggle');
            const searchInput = document.getElementById('searchInput');
            const aiSearchToggle = document.getElementById('aiSearchToggle');
            
            if (!toggle || !searchInput || !aiSearchToggle) return;

            // Load saved state
            const savedAIState = localStorage.getItem('aiSearchEnabled');
            if (savedAIState === 'true') {
                toggle.checked = true;
                updateSearchPlaceholder(true);
            }

            // Handle toggle change
            toggle.addEventListener('change', function() {
                const aiEnabled = this.checked;
                localStorage.setItem('aiSearchEnabled', aiEnabled.toString());
                updateSearchPlaceholder(aiEnabled);
                
                // Add visual feedback
                if (aiEnabled) {
                    aiSearchToggle.style.transform = 'scale(1.05)';
                    setTimeout(() => {
                        aiSearchToggle.style.transform = 'scale(1)';
                    }, 200);
                }
            });

            // Handle search input
            searchInput.addEventListener('input', function() {
                const query = this.value.trim();
                if (query.length > 0) {
                    // Simulate search functionality
                    console.log('Searching for:', query, 'AI enabled:', toggle.checked);
                }
            });

            // Handle Enter key
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const query = this.value.trim();
                    if (query.length > 0) {
                        console.log('Performing search for:', query, 'AI enabled:', toggle.checked);
                        // Here you would typically trigger the actual search
                    }
                }
            });
        }

        // Update search placeholder based on AI toggle state
        function updateSearchPlaceholder(aiEnabled) {
            const searchInput = document.getElementById('searchInput');
            if (!searchInput) return;

            if (aiEnabled) {
                searchInput.placeholder = 'Cerca con AI: descrivi cosa stai cercando...';
            } else {
                searchInput.placeholder = 'Cerca una dispensa...';
            }
        }

        // Filters Button Functionality
        function initializeFiltersButton() {
            const filtersBtn = document.getElementById('filtersBtn');
            const filterCount = document.getElementById('filterCount');
            
            if (!filtersBtn || !filterCount) return;

            // Simulate filter count updates
            let filterCountValue = 0;
            
            filtersBtn.addEventListener('click', function() {
                console.log('Filters button clicked');
                // Here you would typically open the filters panel
                
                // Simulate adding a filter
                filterCountValue++;
                updateFilterCount(filterCountValue);
            });

            // Function to update filter count
            function updateFilterCount(count) {
                filterCount.textContent = count;
                if (count > 0) {
                    filterCount.classList.add('active');
                    filterCount.style.animation = 'filterCountPop 0.3s ease-out';
                    setTimeout(() => {
                        filterCount.style.animation = '';
                    }, 300);
                } else {
                    filterCount.classList.remove('active');
                }
            }

            // Demo: Simulate filter changes
            setTimeout(() => {
                updateFilterCount(2);
            }, 2000);

            setTimeout(() => {
                updateFilterCount(5);
            }, 4000);

            setTimeout(() => {
                updateFilterCount(0);
            }, 6000);
        }

        // Search Bar Focus Effects
        function initializeSearchBarEffects() {
            const searchBar = document.querySelector('.search-bar');
            const searchInput = document.getElementById('searchInput');
            
            if (!searchBar || !searchInput) return;

            // Add focus effects
            searchInput.addEventListener('focus', function() {
                searchBar.style.transform = 'translateY(-2px)';
                searchBar.style.boxShadow = '0 25px 50px -12px rgba(0, 0, 0, 0.15)';
            });

            searchInput.addEventListener('blur', function() {
                searchBar.style.transform = 'translateY(0)';
                searchBar.style.boxShadow = '';
            });

            // Add hover effects for the entire search bar
            searchBar.addEventListener('mouseenter', function() {
                if (document.activeElement !== searchInput) {
                    this.style.transform = 'translateY(-1px)';
                }
            });

            searchBar.addEventListener('mouseleave', function() {
                if (document.activeElement !== searchInput) {
                    this.style.transform = 'translateY(0)';
                }
            });
        }

        // Sticky Search Container
        function initializeStickySearch() {
            const searchContainerWrapper = document.querySelector('.search-container-wrapper');
            
            if (!searchContainerWrapper) return;

            function handleScroll() {
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                const threshold = 200; // Adjust this value to control when the search becomes sticky

                if (scrollTop > threshold) {
                    searchContainerWrapper.classList.add('is-stuck');
                } else {
                    searchContainerWrapper.classList.remove('is-stuck');
                }
            }

            // Throttle scroll events for better performance
            let ticking = false;
            function throttledHandleScroll() {
                if (!ticking) {
                    requestAnimationFrame(() => {
                        handleScroll();
                        ticking = false;
                    });
                    ticking = true;
                }
            }

            window.addEventListener('scroll', throttledHandleScroll);
        }

        // Initialize all functionality when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            initializeAISearchToggle();
            initializeFiltersButton();
            initializeSearchBarEffects();
            initializeStickySearch();
            
            console.log('Search bar component initialized successfully!');
        });

        // Additional utility functions for the search bar
        function performSearch(query, aiEnabled = false) {
            console.log('Performing search:', {
                query: query,
                aiEnabled: aiEnabled,
                timestamp: new Date().toISOString()
            });
            
            // Here you would implement the actual search logic
            // For now, we'll just log the search parameters
        }

        function clearSearch() {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.value = '';
                searchInput.focus();
            }
        }

        function toggleAISearch() {
            const toggle = document.getElementById('toggle');
            if (toggle) {
                toggle.checked = !toggle.checked;
                toggle.dispatchEvent(new Event('change'));
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + K to focus search
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                const searchInput = document.getElementById('searchInput');
                if (searchInput) {
                    searchInput.focus();
                }
            }
            
            // Ctrl/Cmd + L to toggle AI search
            if ((e.ctrlKey || e.metaKey) && e.key === 'l') {
                e.preventDefault();
                toggleAISearch();
            }
            
            // Escape to clear search
            if (e.key === 'Escape') {
                const searchInput = document.getElementById('searchInput');
                if (searchInput && document.activeElement === searchInput) {
                    clearSearch();
                }
            }
        });

        // Export functions for external use
        window.SearchBarComponent = {
            performSearch,
            clearSearch,
            toggleAISearch,
            updateFilterCount: function(count) {
                const filterCount = document.getElementById('filterCount');
                if (filterCount) {
                    filterCount.textContent = count;
                    if (count > 0) {
                        filterCount.classList.add('active');
                    } else {
                        filterCount.classList.remove('active');
                    }
                }
            }
        };
    </script>
</body>
</html>
