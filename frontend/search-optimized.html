<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uniclarity - File Sharing Platform</title>
    
    <!-- DNS prefetch for external resources -->
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    
    <!-- Preconnect to critical origins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- CRITICAL: Inline Critical Path CSS (above-the-fold) -->
    <style>
        /* CSS Reset - Critical Only */
        *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
        html{font-size:16px;scroll-behavior:smooth}
        body{font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(to right,#9ddafd,#84d0fc,#9ddafd);color:#111827;line-height:1.5;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}

        /* Design System Variables - Critical Only */
        :root{
        --white:#ffffff;
        --gray-50:#f9fafb;
        --gray-100:#f3f4f6;
        --gray-200:#e5e7eb;
        --gray-300:#d1d5db;
        --gray-400:#9ca3af;
        --gray-500:#6b7280;
        --gray-600:#4b5563;
        --gray-700:#374151;
        --gray-800:#1f2937;
        --gray-900:#111827;
        --blue-500:#0ea5e9;
        --blue-600:#0284c7;
        --purple-600:#7c3aed;
        --space-2:8px;
        --space-3:12px;
        --space-4:16px;
        --space-6:24px;
        --space-8:32px;
        --radius-lg:12px;
        --radius-xl:16px;
        --radius-2xl:20px;
        --radius-3xl:24px;
        --shadow-md:0 4px 6px -1px rgba(0,0,0,0.1),0 2px 4px -1px rgba(0,0,0,0.06);
        --shadow-lg:0 10px 15px -3px rgba(0,0,0,0.1),0 4px 6px -2px rgba(0,0,0,0.05);
        --transition-fast:150ms ease;
        --transition-normal:300ms ease;
        }

        /* Critical Layout Styles */
        .page-content-wrapper{
        position:relative;
        z-index:1;
        min-height:100vh;
        padding-top:var(--space-8);
        display:flex;
        flex-direction:column;
        align-items:center;
        }

        .search-title{
        font-size:4rem;
        font-weight:700;
        color:var(--white);
        text-align:center;
        margin:0;
        line-height:1.1;
        letter-spacing:-0.02em;
        text-shadow:0 2px 4px rgba(0,0,0,0.1);
        }

        .search-subtitle{
        font-size:1.5rem;
        font-weight:400;
        color:rgba(255,255,255,0.9);
        text-align:center;
        margin:var(--space-4) 0 var(--space-8);
        }

        /* Search Container - Critical Above-fold */
        .search-container-wrapper{
        width:100%;
        max-width:800px;
        margin:0 auto var(--space-8);
        }

        .search-container{
        display:flex;
        gap:var(--space-4);
        align-items:center;
        background:var(--white);
        border-radius:var(--radius-2xl);
        padding:var(--space-4);
        box-shadow:var(--shadow-lg);
        }

        .search-bar-wrapper{
        flex:1;
        position:relative;
        }

        .search-input{
        width:100%;
        border:none;
        outline:none;
        font-size:1.125rem;
        padding:var(--space-4);
        background:transparent;
        color:var(--gray-900);
        }

        .search-input::placeholder{
        color:var(--gray-500);
        }

        /* Filters Button */
        .filters-btn{
        display:flex;
        align-items:center;
        gap:var(--space-2);
        background:var(--gray-100);
        border:none;
        border-radius:var(--radius-lg);
        padding:var(--space-3) var(--space-4);
        color:var(--gray-700);
        font-weight:500;
        cursor:pointer;
        transition:all var(--transition-fast);
        }

        .filters-btn:hover{
        background:var(--gray-200);
        }

        /* Document Grid - Critical Structure */
        .documents-grid{
        display:grid;
        grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
        gap:var(--space-6);
        width:100%;
        max-width:1200px;
        margin:0 auto;
        padding:0 var(--space-4);
        }

        /* Document Cards - EXACT DIMENSIONS FOR LAYOUT STABILITY */
        .document-card{
        position:relative;
        background:var(--white);
        border:1px solid var(--gray-200);
        border-radius:var(--radius-3xl);
        overflow:hidden;
        cursor:pointer;
        transition:transform var(--transition-fast),box-shadow var(--transition-fast),border-color var(--transition-fast);
        box-shadow:var(--shadow-md);
        height:560px;
        display:flex;
        flex-direction:column;
        min-width:0;
        width:100%;
        }

        .document-preview{
        position:relative;
        height:240px;
        min-height:240px;
        max-height:240px;
        overflow:hidden;
        background:linear-gradient(135deg,var(--gray-50) 0%,var(--gray-100) 100%);
        border-bottom:1px solid var(--gray-200);
        display:flex;
        align-items:center;
        justify-content:center;
        flex-shrink:0;
        }

        .document-content{
        padding:var(--space-6);
        flex:1;
        display:flex;
        flex-direction:column;
        }

        .document-header{
        margin-bottom:var(--space-4);
        }

        .document-title{
        font-size:1.25rem;
        font-weight:600;
        color:var(--gray-900);
        line-height:1.3;
        margin-bottom:var(--space-2);
        display:-webkit-box;
        -webkit-line-clamp:2;
        -webkit-box-orient:vertical;
        overflow:hidden;
        }

        .document-author{
        font-size:0.875rem;
        color:var(--gray-600);
        font-weight:500;
        }

        .document-info{
        flex:1;
        display:flex;
        flex-direction:column;
        gap:var(--space-2);
        margin-bottom:var(--space-4);
        }

        .document-footer{
        display:flex;
        justify-content:space-between;
        align-items:center;
        }

        /* Loading Cards - IDENTICAL DIMENSIONS */
        .loading-card{
        position:relative;
        background:var(--white);
        border:1px solid var(--gray-200);
        border-radius:var(--radius-3xl);
        overflow:hidden;
        height:560px;
        display:flex;
        flex-direction:column;
        min-width:0;
        width:100%;
        pointer-events:none;
        }

        .loading-card .document-preview{
        height:240px;
        min-height:240px;
        max-height:240px;
        background:var(--gray-100);
        border-bottom:1px solid var(--gray-200);
        }

        .loading-card .document-content{
        padding:var(--space-6);
        flex:1;
        display:flex;
        flex-direction:column;
        }

        /* Skeleton Elements - Precise Dimensions */
        .skeleton-title{
        height:24px;
        background:var(--gray-200);
        border-radius:4px;
        width:85%;
        margin-bottom:var(--space-2);
        animation:skeleton-pulse 1.5s ease-in-out infinite;
        }

        .skeleton-author{
        height:16px;
        background:var(--gray-200);
        border-radius:4px;
        width:60%;
        margin-bottom:var(--space-4);
        animation:skeleton-pulse 1.5s ease-in-out infinite;
        animation-delay:0.1s;
        }

        .skeleton-line{
        height:16px;
        background:var(--gray-200);
        border-radius:4px;
        margin-bottom:var(--space-2);
        animation:skeleton-pulse 1.5s ease-in-out infinite;
        }

        .skeleton-line:nth-child(1){width:92%;animation-delay:0.2s}
        .skeleton-line:nth-child(2){width:88%;animation-delay:0.3s}
        .skeleton-line:nth-child(3){width:85%;animation-delay:0.4s}
        .skeleton-line:nth-child(4){width:90%;animation-delay:0.5s}

        .skeleton-avatar{
        width:32px;
        height:32px;
        border-radius:50%;
        background:var(--gray-200);
        animation:skeleton-pulse 1.5s ease-in-out infinite;
        animation-delay:0.6s;
        }

        .skeleton-meta{
        height:14px;
        width:80px;
        background:var(--gray-200);
        border-radius:4px;
        animation:skeleton-pulse 1.5s ease-in-out infinite;
        animation-delay:0.7s;
        }

        .skeleton-price{
        height:20px;
        width:60px;
        background:var(--gray-200);
        border-radius:4px;
        animation:skeleton-pulse 1.5s ease-in-out infinite;
        animation-delay:0.8s;
        }

        .skeleton-footer-left{
        display:flex;
        align-items:center;
        gap:var(--space-2);
        }

        @keyframes skeleton-pulse{
        0%,100%{opacity:1}
        50%{opacity:0.5}
        }

        /* Background Image - Base positioning only */
        .background-image{
        position:fixed;
        top:0;
        left:0;
        width:100vw;
        z-index:-1;
        will-change:transform;
        /* Background applied by JavaScript for immediate loading */
        }

        /* Material Icons - Critical Styles */
        .material-symbols-outlined{
        font-family:'Material Symbols Outlined','Material Icons',-apple-system,BlinkMacSystemFont,sans-serif;
        font-weight:normal;
        font-style:normal;
        font-size:24px;
        line-height:1;
        letter-spacing:normal;
        text-transform:none;
        display:inline-block;
        white-space:nowrap;
        word-wrap:normal;
        direction:ltr;
        -webkit-font-feature-settings:'liga';
        font-feature-settings:'liga';
        -webkit-font-smoothing:antialiased;
        -moz-osx-font-smoothing:grayscale;
        }

        /* Responsive - Critical Breakpoints Only */
        @media (max-width:768px){
        .search-title{font-size:2.5rem}
        .search-subtitle{font-size:1.25rem}
        .documents-grid{grid-template-columns:1fr;padding:0 var(--space-4)}
        .document-card{height:480px}
        .loading-card{height:480px}
        .document-preview{height:200px;min-height:200px;max-height:200px}
        .loading-card .document-preview{height:200px;min-height:200px;max-height:200px}
        }

        @media (max-width:640px){
        .search-container{flex-direction:column;gap:var(--space-3)}
        .document-card{height:420px}
        .loading-card{height:420px}
        .document-preview{height:180px;min-height:180px;max-height:180px}
        .loading-card .document-preview{height:180px;min-height:180px;max-height:180px}
        }

        /* Performance optimizations */
        body.ui-ready .search-input{animation:fade-in 0.3s ease-out}
        @keyframes fade-in{from{opacity:0}to{opacity:1}}
    </style>
    
    <!-- REMOVED: Background image preload (causes race condition with CSS) -->
    <!-- Background image is now loaded directly via CSS - no preload needed -->
    <link rel="preload" href="images/Logo.png" as="image" type="image/png">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    
    <!-- CRITICAL: Immediate background image application -->
    <script>
        // Ultra-fast background image application - runs immediately
        (function() {
            console.log('🎨 Applying background image immediately...');
            
            // Method 1: Inline style injection (highest priority)
            const style = document.createElement('style');
            style.textContent = `
                .background-image {
                    position: fixed !important;
                    top: 0 !important;
                    left: 0 !important;
                    width: 100vw !important;
                    z-index: -1 !important;
                    background-image: url('images/bg.png') !important;
                    background-size: 100vw auto !important;
                    background-repeat: no-repeat !important;
                    background-position: center top !important;
                    will-change: transform !important;
                }
            `;
            document.head.appendChild(style);
            
            // Method 2: Direct DOM application when element exists
            function applyDirectly() {
                const bgElement = document.querySelector('.background-image');
                if (bgElement) {
                    bgElement.style.backgroundImage = 'url("images/bg.png")';
                    bgElement.style.backgroundSize = '100vw auto';
                    bgElement.style.backgroundRepeat = 'no-repeat';
                    bgElement.style.backgroundPosition = 'center top';
                    console.log('✅ Background applied directly to element');
                    return true;
                }
                return false;
            }
            
            // Try immediate application
            if (!applyDirectly()) {
                // If element doesn't exist yet, wait for DOM
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', applyDirectly);
                } else {
                    // Try again after a short delay
                    setTimeout(applyDirectly, 10);
                }
            }
            
            console.log('✅ Background image application initiated');
        })();
    </script>
    
    <!-- Material Icons - Load with optimal font-display -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    
    <!-- Favicon -->
    <link rel="icon" href="images/favicon.png" type="image/png">
</head>
<body data-page="search">
    <!-- Background Image Element -->
    <div class="background-image" aria-hidden="true"></div>

    <!-- Header Component Container -->
    <div id="headerContainer"></div>

    <!-- Page Content Wrapper -->
    <div class="page-content-wrapper" id="pageContentWrapper">
        <h1 class="search-title" id="searchTitle">Cerca.</h1>
        <p class="search-subtitle" id="searchSubtitle">Pensato per chi vuole di più.</p>
        
        <!-- Search Container -->
        <div class="search-container-wrapper">
            <div class="search-container">
                <div class="search-bar-wrapper">
                    <input type="text" class="search-input" id="searchInput" placeholder="Cerca una dispensa..." autofocus>
                </div>
                <button class="filters-btn" id="filtersBtn">
                    <i class="material-symbols-outlined">tune</i>
                    <span class="filters-text">Filtri</span>
                </button>
            </div>
        </div>
        
        <!-- Documents Grid - Instant Loading with Skeletons -->
        <div class="documents-grid loading" id="documentsGrid">
            <!-- Initial Skeleton Cards for Zero Layout Shift -->
            <div class="document-card loading-card">
                <div class="document-preview"></div>
                <div class="document-content">
                    <div class="document-header">
                        <div class="skeleton-title"></div>
                        <div class="skeleton-author"></div>
                    </div>
                    <div class="document-info">
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                    </div>
                    <div class="document-footer">
                        <div class="skeleton-footer-left">
                            <div class="skeleton-avatar"></div>
                            <div class="skeleton-meta"></div>
                        </div>
                        <div class="skeleton-price"></div>
                    </div>
                </div>
            </div>
            <div class="document-card loading-card">
                <div class="document-preview"></div>
                <div class="document-content">
                    <div class="document-header">
                        <div class="skeleton-title"></div>
                        <div class="skeleton-author"></div>
                    </div>
                    <div class="document-info">
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                    </div>
                    <div class="document-footer">
                        <div class="skeleton-footer-left">
                            <div class="skeleton-avatar"></div>
                            <div class="skeleton-meta"></div>
                        </div>
                        <div class="skeleton-price"></div>
                    </div>
                </div>
            </div>
            <div class="document-card loading-card">
                <div class="document-preview"></div>
                <div class="document-content">
                    <div class="document-header">
                        <div class="skeleton-title"></div>
                        <div class="skeleton-author"></div>
                    </div>
                    <div class="document-info">
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                    </div>
                    <div class="document-footer">
                        <div class="skeleton-footer-left">
                            <div class="skeleton-avatar"></div>
                            <div class="skeleton-meta"></div>
                        </div>
                        <div class="skeleton-price"></div>
                    </div>
                </div>
            </div>
            <div class="document-card loading-card">
                <div class="document-preview"></div>
                <div class="document-content">
                    <div class="document-header">
                        <div class="skeleton-title"></div>
                        <div class="skeleton-author"></div>
                    </div>
                    <div class="document-info">
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                    </div>
                    <div class="document-footer">
                        <div class="skeleton-footer-left">
                            <div class="skeleton-avatar"></div>
                            <div class="skeleton-meta"></div>
                        </div>
                        <div class="skeleton-price"></div>
                    </div>
                </div>
            </div>
            <div class="document-card loading-card">
                <div class="document-preview"></div>
                <div class="document-content">
                    <div class="document-header">
                        <div class="skeleton-title"></div>
                        <div class="skeleton-author"></div>
                    </div>
                    <div class="document-info">
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                    </div>
                    <div class="document-footer">
                        <div class="skeleton-footer-left">
                            <div class="skeleton-avatar"></div>
                            <div class="skeleton-meta"></div>
                        </div>
                        <div class="skeleton-price"></div>
                    </div>
                </div>
            </div>
            <div class="document-card loading-card">
                <div class="document-preview"></div>
                <div class="document-content">
                    <div class="document-header">
                        <div class="skeleton-title"></div>
                        <div class="skeleton-author"></div>
                    </div>
                    <div class="document-info">
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                    </div>
                    <div class="document-footer">
                        <div class="skeleton-footer-left">
                            <div class="skeleton-avatar"></div>
                            <div class="skeleton-meta"></div>
                        </div>
                        <div class="skeleton-price"></div>
                    </div>
                </div>
            </div>
            <div class="document-card loading-card">
                <div class="document-preview"></div>
                <div class="document-content">
                    <div class="document-header">
                        <div class="skeleton-title"></div>
                        <div class="skeleton-author"></div>
                    </div>
                    <div class="document-info">
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                    </div>
                    <div class="document-footer">
                        <div class="skeleton-footer-left">
                            <div class="skeleton-avatar"></div>
                            <div class="skeleton-meta"></div>
                        </div>
                        <div class="skeleton-price"></div>
                    </div>
                </div>
            </div>
            <div class="document-card loading-card">
                <div class="document-preview"></div>
                <div class="document-content">
                    <div class="document-header">
                        <div class="skeleton-title"></div>
                        <div class="skeleton-author"></div>
                    </div>
                    <div class="document-info">
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                        <div class="skeleton-line"></div>
                    </div>
                    <div class="document-footer">
                        <div class="skeleton-footer-left">
                            <div class="skeleton-avatar"></div>
                            <div class="skeleton-meta"></div>
                        </div>
                        <div class="skeleton-price"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Instant Loading System - Highest Priority -->
    <script>
        // Initialize instant loading system immediately
        window.performance.mark('page-start');
        
        // Critical configuration
        window.APP_CONFIG = {
            API_BASE: 'https://symbia.it'
        };
    </script>
    
    <!-- Load instant loading system -->
    <script type="module" src="js/instant-loading-system.js"></script>
    
    <!-- Development: Background fix test (non-module) -->
    <script src="js/background-fix-test.js"></script>
    
    <!-- Load non-critical resources asynchronously -->
    <script>
        // Load non-critical CSS asynchronously
        function loadCSS(href) {
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = href;
            document.head.appendChild(link);
        }
        
        // Load header component
        function loadHeader() {
            fetch('components/header/header.html')
                .then(response => response.text())
                .then(html => {
                    document.getElementById('headerContainer').innerHTML = html;
                    // Load header CSS
                    loadCSS('components/header/header.css');
                })
                .catch(error => console.error('Error loading header:', error));
        }
        
        // Load components after critical path
        window.addEventListener('load', () => {
            // Load header
            loadHeader();
            
            // Load non-critical CSS
            loadCSS('css/search.css?v=1.2');
            loadCSS('components/search-section/search-component.css');
            
            // Mark page as fully loaded
            window.performance.mark('page-complete');
            window.performance.measure('page-load-time', 'page-start', 'page-complete');
        });
    </script>
</body>
</html>