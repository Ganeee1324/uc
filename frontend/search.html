<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uniclarity - File Sharing Platform</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Preload critical assets with high priority -->
    <link rel="preload" href="images/bg.png" as="image" type="image/png" fetchpriority="high">
    <link rel="preload" href="images/Logo.png" as="image" type="image/png">
    <link rel="preload" href="css/search.css?v=1.2" as="style">
    <link rel="preload" href="js/search.js" as="script">
    <link rel="preload" href="components/search-section/search-component.js" as="script">
    
    <!-- THE SOLUTION: CSS-First Deterministic Positioning -->
    <style>
        :root {
            /* Exact layout calculations based on known CSS values */
            --title-height: 36px;
            --title-margin-bottom: -10px;
            --subtitle-height: 36px; 
            --subtitle-margin-bottom: 16px;
            --page-top-margin: calc(80px + 40px); /* header + space-10 */
            --search-container-spacing: 40px;
            
            /* Calculate precise anchor point between subtitle and search container */
            --page-anchor-y: calc(
                var(--page-top-margin) + 
                var(--title-height) + 
                var(--title-margin-bottom) + 
                var(--subtitle-height) + 
                var(--subtitle-margin-bottom) + 
                (var(--search-container-spacing) * 0.25)
            );
            
            /* Mobile adjustments */
            --mobile-title-height: 32px;
            --mobile-subtitle-height: 28px;
            --mobile-spacing: 20px;
            
            /* Background image aspect ratio - must be set based on actual image */
            --bg-aspect-ratio: 1.778; /* 16:9 fallback, will be set dynamically */
        }
        
        /* PROFESSIONAL UNIFIED Background Positioning - ALL screen sizes */
        .background-image {
            position: absolute !important;
            left: -1px !important;
            width: calc(100vw + 2px) !important;
            height: calc((100vw + 2px) / var(--bg-aspect-ratio)) !important;
            top: calc((var(--page-anchor-y)) - ((100vw + 2px) / var(--bg-aspect-ratio) * 0.5)) !important;
            background-image: url('images/bg.png') !important;
            background-size: 100% 100% !important;
            background-repeat: no-repeat !important;
            background-position: center center !important;
            z-index: -1 !important;
            pointer-events: none !important;
            opacity: 1 !important;
            visibility: visible !important;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
            transform: translateZ(0) !important;
            will-change: transform !important;
        }
        
        /* RESPONSIVE BACKGROUND ADJUSTMENTS - Match header heights */
        @media (max-width: 1023px) and (min-width: 768px) {
            :root {
                --title-height: var(--mobile-title-height);
                --subtitle-height: var(--mobile-subtitle-height);
                --search-container-spacing: var(--mobile-spacing);
                --page-top-margin: calc(70px + 40px); /* Tablet header + space */
            }
        }
        
        @media (max-width: 767px) {
            :root {
                --title-height: var(--mobile-title-height);
                --subtitle-height: var(--mobile-subtitle-height);
                --search-container-spacing: var(--mobile-spacing);
                --page-top-margin: calc(70px + 32px); /* Mobile header + space */
            }
        }
        
        @media (max-width: 479px) {
            :root {
                --page-top-margin: calc(64px + 24px); /* Small mobile header + space */
                --search-container-spacing: 16px;
            }
        }
        
        /* Search bar background visibility handled in component CSS */
    </style>
    
    <!-- Set actual image aspect ratio immediately -->
    <script>
        // THE SOLUTION: Set aspect ratio immediately, no timing dependencies
        const img = new Image();
        img.src = 'images/bg.png';
        
        function setAspectRatio() {
            if (img.naturalWidth > 0 && img.naturalHeight > 0) {
                const aspectRatio = img.naturalWidth / img.naturalHeight;
                document.documentElement.style.setProperty('--bg-aspect-ratio', aspectRatio);
                console.log('ðŸŽ¯ Aspect ratio set:', aspectRatio);
            }
        }
        
        // Handle both cached and non-cached
        if (img.complete) setAspectRatio();
        else img.onload = setAspectRatio;
    </script>
    
    <!-- Load fonts with display=swap for better performance -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons&display=swap">
    
    <!-- Main stylesheet -->
    <link rel="stylesheet" href="css/search.css?v=1.2">
    <link rel="stylesheet" href="components/header/header.css">
    <link rel="stylesheet" href="components/search-section/search-component.css">
    
    <!-- Override component styles - must load after component CSS -->
    <style>
        /* Clean, simple overrides for background path consistency */
        .background-image {
            background-image: url('images/bg.png') !important;
        }
    </style>
    
    <!-- Favicon -->
    <link rel="icon" href="images/favicon.png" type="image/png">
</head>
<body data-page="search">
    <!-- Background Image Element -->
    <div class="background-image" aria-hidden="true"></div>

    <!-- Header Component - Inline for Instant Loading -->
    <header class="header">
        <a href="search.html" class="logo">
            <img src="images/Logo.png" alt="Uniclarity">
        </a>
        
        <!-- Navigation Menu -->
        <nav class="nav-menu">
            <a href="search.html" class="nav-link">Cerca</a>
            <a href="documenti.html" class="nav-link">Risorse</a>
            <a href="#forum" class="nav-link">Forum</a>
        </nav>
        
        <div class="auth-buttons">
            <div class="divider"></div>
            <a href="upload.html" class="nav-link">Carica</a>
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">
                    <!-- Login button will be inserted here by JavaScript when user is not authenticated -->
                </div>
                <div class="user-dropdown" id="userDropdown">
                    <div class="dropdown-user-info">
                        <div class="dropdown-avatar" id="dropdownAvatar"></div>
                        <div class="dropdown-user-details">
                            <span class="dropdown-user-name" id="dropdownUserName"></span>
                            <span class="dropdown-user-email" id="dropdownUserEmail"></span>
                        </div>
                    </div>
                    <div class="dropdown-divider"></div>
                    <a href="profile.html#settings" class="dropdown-item">
                        <i class="material-symbols-outlined">settings</i>
                        <span>Impostazioni</span>
                    </a>
                    <a href="preferiti.html" class="dropdown-item" id="userFavorites">
                        <i class="material-symbols-outlined">favorite</i>
                        <span>Preferiti</span>
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="#" class="dropdown-item" id="logoutBtn">
                        <i class="material-symbols-outlined">logout</i>
                        <span>Logout</span>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Page Content Wrapper -->
    <div class="page-content-wrapper" id="pageContentWrapper">
        <h1 class="search-title" id="searchTitle">Cerca.</h1>
        <p class="search-subtitle" id="searchSubtitle">Pensato per chi vuole di piÃ¹.</p>
        
        <!-- Search Component - Inline for Instant Loading -->
        <main class="main-content" id="mainContent">
            <!-- Search Section with integrated cards -->
            <div class="search-section has-results" id="searchSection">
                
                <div class="search-container-wrapper">
                    <div class="search-container">
                        <div class="search-bar-wrapper">
                            <div class="search-bar-background" id="searchBarBackground"></div>
                            <div class="search-bar">
                                <input type="text" class="search-input" id="searchInput" placeholder="Cerca una dispensa...">
                                <button type="button" class="search-btn" id="searchBtn" aria-label="Cerca documenti">
                                    <i class="material-symbols-outlined">search</i>
                                </button>
                                <input class="toggle-input" id="toggle" name="toggle" type="checkbox" />
                                <label class="toggle-label" for="toggle" id="aiSearchToggle">
                                  <div class="cont-icon">
                                    <span style="--width: 2; --deg: 25; --duration: 11" class="sparkle"></span>
                                    <span style="--width: 1; --deg: 100; --duration: 18" class="sparkle"></span>
                                    <span style="--width: 1; --deg: 280; --duration: 5" class="sparkle"></span>
                                    <span style="--width: 2; --deg: 200; --duration: 3" class="sparkle"></span>
                                    <span style="--width: 2; --deg: 30; --duration: 20" class="sparkle"></span>
                                    <span style="--width: 2; --deg: 300; --duration: 9" class="sparkle"></span>
                                    <span style="--width: 1; --deg: 250; --duration: 4" class="sparkle"></span>
                                    <span style="--width: 2; --deg: 210; --duration: 8" class="sparkle"></span>
                                    <span style="--width: 2; --deg: 100; --duration: 9" class="sparkle"></span>
                                    <span style="--width: 1; --deg: 15; --duration: 13" class="sparkle"></span>
                                    <span style="--width: 1; --deg: 75; --duration: 18" class="sparkle"></span>
                                    <span style="--width: 2; --deg: 65; --duration: 6" class="sparkle"></span>
                                    <span style="--width: 2; --deg: 50; --duration: 7" class="sparkle"></span>
                                    <span style="--width: 1; --deg: 320; --duration: 5" class="sparkle"></span>
                                    <span style="--width: 1; --deg: 220; --duration: 5" class="sparkle"></span>
                                    <span style="--width: 1; --deg: 215; --duration: 2" class="sparkle"></span>
                                    <span style="--width: 2; --deg: 135; --duration: 9" class="sparkle"></span>
                                    <span style="--width: 2; --deg: 45; --duration: 4" class="sparkle"></span>
                                    <span style="--width: 1; --deg: 78; --duration: 16" class="sparkle"></span>
                                    <span style="--width: 1; --deg: 89; --duration: 19" class="sparkle"></span>
                                    <span style="--width: 2; --deg: 65; --duration: 14" class="sparkle"></span>
                                    <span style="--width: 2; --deg: 97; --duration: 1" class="sparkle"></span>
                                    <span style="--width: 1; --deg: 174; --duration: 10" class="sparkle"></span>
                                    <span style="--width: 1; --deg: 236; --duration: 5" class="sparkle"></span>
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 30 30" class="icon">
                                      <path d="M0.96233 28.61C1.36043 29.0081 1.96007 29.1255 2.47555 28.8971L10.4256 25.3552C13.2236 24.11 16.4254 24.1425 19.2107 25.4401L27.4152 29.2747C27.476 29.3044 27.5418 29.3023 27.6047 29.32C27.6563 29.3348 27.7079 29.3497 27.761 29.3574C27.843 29.3687 27.9194 29.3758 28 29.3688C28.1273 29.3617 28.2531 29.3405 28.3726 29.2945C28.4447 29.262 28.5162 29.2287 28.5749 29.1842C28.6399 29.1446 28.6993 29.0994 28.7509 29.0477L28.9008 28.8582C28.9468 28.7995 28.9793 28.7274 29.0112 28.656C29.0599 28.5322 29.0811 28.4036 29.0882 28.2734C29.0939 28.1957 29.0868 28.1207 29.0769 28.0415C29.0705 27.9955 29.0585 27.9524 29.0472 27.9072C29.0295 27.8343 29.0302 27.7601 28.9984 27.6901L25.1638 19.4855C23.8592 16.7073 23.8273 13.5048 25.0726 10.7068L28.6145 2.75679C28.8429 2.24131 28.7318 1.63531 28.3337 1.2372C27.9165 0.820011 27.271 0.721743 26.7491 0.9961L19.8357 4.59596C16.8418 6.15442 13.2879 6.18696 10.2615 4.70062L1.80308 0.520214C1.7055 0.474959 1.60722 0.441742 1.50964 0.421943C1.44459 0.409215 1.37882 0.395769 1.3074 0.402133C1.14406 0.395769 0.981436 0.428275 0.818095 0.499692C0.77284 0.519491 0.719805 0.545671 0.67455 0.578198C0.596061 0.617088 0.524653 0.675786 0.4596 0.74084C0.394546 0.805894 0.335843 0.877306 0.296245 0.956502C0.263718 1.00176 0.237561 1.05477 0.217762 1.10003C0.152708 1.24286 0.126545 1.40058 0.120181 1.54978C0.120181 1.61483 0.126527 1.6735 0.132891 1.73219C0.15269 1.85664 0.178881 1.97332 0.237571 2.08434L4.41798 10.5427C5.91139 13.5621 5.8725 17.1238 4.3204 20.1099L0.720514 27.0233C0.440499 27.5536 0.545137 28.1928 0.96233 28.61Z"></path>
                                    </svg>
                                  </div>
                                </label>
                            </div>
                        </div>
                        <button class="filters-btn" id="filtersBtn">
                            <i class="material-symbols-outlined">tune</i>
                            <span class="filters-text">Filtri</span>
                            <span class="filter-count" id="filterCount">0</span>
                        </button>
                    </div>
                </div>
                
                <!-- Document Count and Active Filters Display -->
                <div id="documentCountContainer" class="document-count-container" style="display: block;">
                    <div class="document-count-and-filters">
                        <span id="documentCount" class="document-count">Caricamento...</span>
                        
                        <!-- Order Dropdown Button -->
                        <span class="order-label" style="font-weight: 500; color: #64748b; font-size: 0.95em;">Ordina per:</span>
                        <div class="order-dropdown-container">
                            <button class="order-btn" id="orderBtn">
                                <svg class="sort-icon" width="20" height="20" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
                                    <g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)" fill="currentColor" stroke="none">
                                        <path d="M1982 4688 c-24 -4 -56 -15 -70 -25 -52 -35 -1340 -1338 -1358 -1373 -27 -55 -23 -137 10 -194 39 -66 93 -99 170 -104 49 -3 71 0 102 16 23 12 234 216 504 486 l465 466 5 -1693 5 -1694 30 -48 c40 -65 97 -95 179 -95 104 1 182 53 206 138 7 25 10 680 10 2000 0 2134 3 2000 -53 2060 -46 49 -129 74 -205 60z"/>
                                        <path d="M2995 4671 c-50 -22 -91 -69 -105 -119 -7 -25 -10 -680 -10 -2000 0 -1749 2 -1967 15 -2000 35 -83 103 -123 207 -123 50 0 77 5 96 18 51 35 1350 1348 1368 1383 10 21 17 57 17 91 0 109 -81 198 -187 207 -105 9 -90 20 -608 -496 l-478 -476 -2 1695 -3 1696 -30 48 c-40 65 -97 95 -179 95 -37 0 -77 -8 -101 -19z"/>
                                    </g>
                                </svg>
                                <span class="order-text">Rilevanza</span>
                            </button>
                            <div class="order-dropdown-content">
                                <div class="order-option" data-order="relevance">
                                    <span class="material-symbols-outlined">auto_awesome</span>
                                    <span class="order-text">Rilevanza</span>
                                </div>
                                <div class="order-option" data-order="reviews">
                                    <span class="material-symbols-outlined">star</span>
                                    <span class="order-text">Recensioni</span>
                                </div>
                                <div class="order-option" data-order="price-lowest">
                                    <span class="material-symbols-outlined">trending_up</span>
                                    <span class="order-text">Prezzo crescente</span>
                                </div>
                                <div class="order-option" data-order="price-highest">
                                    <span class="material-symbols-outlined">trending_down</span>
                                    <span class="order-text">Prezzo decrescente</span>
                                </div>
                                <div class="order-option" data-order="date-newest">
                                    <span class="material-symbols-outlined">schedule</span>
                                    <span class="order-text">PiÃ¹ recenti</span>
                                </div>
                                <div class="order-option" data-order="date-oldest">
                                    <span class="material-symbols-outlined">history</span>
                                    <span class="order-text">Meno recenti</span>
                                </div>
                                <div class="order-option" data-order="name-asc">
                                    <span class="az-text">AZ</span>
                                    <span class="order-text">Nome A-Z</span>
                                </div>
                                <div class="order-option" data-order="name-desc">
                                    <span class="az-text">ZA</span>
                                    <span class="order-text">Nome Z-A</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="activeFiltersDisplay" class="active-filters-display" style="padding-bottom: 10px;">
                        <!-- Active filter pills will be dynamically added here -->
                    </div>
                </div>

                <!-- Documents Grid - Will be populated dynamically -->
                <div class="documents-grid" id="documentsGrid">
                    <!-- Initial loading cards to prevent layout shift -->
                    <div class="document-card loading-card">
                        <div class="document-preview loading-preview">
                            <div class="skeleton-preview-circle"></div>
                            <div class="skeleton-rating-badge"></div>
                            <div class="skeleton-preview-bar"></div>
                        </div>
                        <div class="skeleton-favorite-button"></div>
                        <div class="document-content">
                            <div class="document-header">
                                <div class="document-title-section">
                                    <div class="skeleton-title"></div>
                                    <div class="skeleton-author"></div>
                                </div>
                            </div>
                            <div class="document-info">
                                <div class="skeleton-line info-item"></div>
                                <div class="skeleton-line info-item"></div>
                                <div class="skeleton-line info-item"></div>
                                <div class="skeleton-line info-item"></div>
                            </div>
                            <div class="document-footer">
                                <div class="skeleton-footer-left">
                                    <div class="skeleton-avatar"></div>
                                    <div class="skeleton-meta"></div>
                                </div>
                                <div class="skeleton-price"></div>
                            </div>
                        </div>
                    </div>
                    <div class="document-card loading-card">
                        <div class="document-preview loading-preview">
                            <div class="skeleton-preview-circle"></div>
                            <div class="skeleton-rating-badge"></div>
                            <div class="skeleton-preview-bar"></div>
                        </div>
                        <div class="skeleton-favorite-button"></div>
                        <div class="document-content">
                            <div class="document-header">
                                <div class="document-title-section">
                                    <div class="skeleton-title"></div>
                                    <div class="skeleton-author"></div>
                                </div>
                            </div>
                            <div class="document-info">
                                <div class="skeleton-line info-item"></div>
                                <div class="skeleton-line info-item"></div>
                                <div class="skeleton-line info-item"></div>
                                <div class="skeleton-line info-item"></div>
                            </div>
                            <div class="document-footer">
                                <div class="skeleton-footer-left">
                                    <div class="skeleton-avatar"></div>
                                    <div class="skeleton-meta"></div>
                                </div>
                                <div class="skeleton-price"></div>
                            </div>
                        </div>
                    </div>
                    <div class="document-card loading-card">
                        <div class="document-preview loading-preview">
                            <div class="skeleton-preview-circle"></div>
                            <div class="skeleton-rating-badge"></div>
                            <div class="skeleton-preview-bar"></div>
                        </div>
                        <div class="skeleton-favorite-button"></div>
                        <div class="document-content">
                            <div class="document-header">
                                <div class="document-title-section">
                                    <div class="skeleton-title"></div>
                                    <div class="skeleton-author"></div>
                                </div>
                            </div>
                            <div class="document-info">
                                <div class="skeleton-line info-item"></div>
                                <div class="skeleton-line info-item"></div>
                                <div class="skeleton-line info-item"></div>
                                <div class="skeleton-line info-item"></div>
                            </div>
                            <div class="document-footer">
                                <div class="skeleton-footer-left">
                                    <div class="skeleton-avatar"></div>
                                    <div class="skeleton-meta"></div>
                                </div>
                                <div class="skeleton-price"></div>
                            </div>
                        </div>
                    </div>
                    <div class="document-card loading-card">
                        <div class="document-preview loading-preview">
                            <div class="skeleton-preview-circle"></div>
                            <div class="skeleton-rating-badge"></div>
                            <div class="skeleton-preview-bar"></div>
                        </div>
                        <div class="skeleton-favorite-button"></div>
                        <div class="document-content">
                            <div class="document-header">
                                <div class="document-title-section">
                                    <div class="skeleton-title"></div>
                                    <div class="skeleton-author"></div>
                                </div>
                            </div>
                            <div class="document-info">
                                <div class="skeleton-line info-item"></div>
                                <div class="skeleton-line info-item"></div>
                                <div class="skeleton-line info-item"></div>
                                <div class="skeleton-line info-item"></div>
                            </div>
                            <div class="document-footer">
                                <div class="skeleton-footer-left">
                                    <div class="skeleton-avatar"></div>
                                    <div class="skeleton-meta"></div>
                                </div>
                                <div class="skeleton-price"></div>
                            </div>
                        </div>
                    </div>
                    <div class="document-card loading-card">
                        <div class="document-preview loading-preview">
                            <div class="skeleton-preview-circle"></div>
                            <div class="skeleton-rating-badge"></div>
                            <div class="skeleton-preview-bar"></div>
                        </div>
                        <div class="skeleton-favorite-button"></div>
                        <div class="document-content">
                            <div class="document-header">
                                <div class="document-title-section">
                                    <div class="skeleton-title"></div>
                                    <div class="skeleton-author"></div>
                                </div>
                            </div>
                            <div class="document-info">
                                <div class="skeleton-line info-item"></div>
                                <div class="skeleton-line info-item"></div>
                                <div class="skeleton-line info-item"></div>
                                <div class="skeleton-line info-item"></div>
                            </div>
                            <div class="document-footer">
                                <div class="skeleton-footer-left">
                                    <div class="skeleton-avatar"></div>
                                    <div class="skeleton-meta"></div>
                                </div>
                                <div class="skeleton-price"></div>
                            </div>
                        </div>
                    </div>
                    <div class="document-card loading-card">
                        <div class="document-preview loading-preview">
                            <div class="skeleton-preview-circle"></div>
                            <div class="skeleton-rating-badge"></div>
                            <div class="skeleton-preview-bar"></div>
                        </div>
                        <div class="skeleton-favorite-button"></div>
                        <div class="document-content">
                            <div class="document-header">
                                <div class="document-title-section">
                                    <div class="skeleton-title"></div>
                                    <div class="skeleton-author"></div>
                                </div>
                            </div>
                            <div class="document-info">
                                <div class="skeleton-line info-item"></div>
                                <div class="skeleton-line info-item"></div>
                                <div class="skeleton-line info-item"></div>
                                <div class="skeleton-line info-item"></div>
                            </div>
                            <div class="document-footer">
                                <div class="skeleton-footer-left">
                                    <div class="skeleton-avatar"></div>
                                    <div class="skeleton-meta"></div>
                                </div>
                                <div class="skeleton-price"></div>
                            </div>
                        </div>
                    </div>
                    <div class="document-card loading-card">
                        <div class="document-preview loading-preview">
                            <div class="skeleton-preview-circle"></div>
                            <div class="skeleton-rating-badge"></div>
                            <div class="skeleton-preview-bar"></div>
                        </div>
                        <div class="skeleton-favorite-button"></div>
                        <div class="document-content">
                            <div class="document-header">
                                <div class="document-title-section">
                                    <div class="skeleton-title"></div>
                                    <div class="skeleton-author"></div>
                                </div>
                            </div>
                            <div class="document-info">
                                <div class="skeleton-line info-item"></div>
                                <div class="skeleton-line info-item"></div>
                                <div class="skeleton-line info-item"></div>
                                <div class="skeleton-line info-item"></div>
                            </div>
                            <div class="document-footer">
                                <div class="skeleton-footer-left">
                                    <div class="skeleton-avatar"></div>
                                    <div class="skeleton-meta"></div>
                                </div>
                                <div class="skeleton-price"></div>
                            </div>
                        </div>
                    </div>
                    <div class="document-card loading-card">
                        <div class="document-preview loading-preview">
                            <div class="skeleton-preview-circle"></div>
                            <div class="skeleton-rating-badge"></div>
                            <div class="skeleton-preview-bar"></div>
                        </div>
                        <div class="skeleton-favorite-button"></div>
                        <div class="document-content">
                            <div class="document-header">
                                <div class="document-title-section">
                                    <div class="skeleton-title"></div>
                                    <div class="skeleton-author"></div>
                                </div>
                            </div>
                            <div class="document-info">
                                <div class="skeleton-line info-item"></div>
                                <div class="skeleton-line info-item"></div>
                                <div class="skeleton-line info-item"></div>
                                <div class="skeleton-line info-item"></div>
                            </div>
                            <div class="document-footer">
                                <div class="skeleton-footer-left">
                                    <div class="skeleton-avatar"></div>
                                    <div class="skeleton-meta"></div>
                                </div>
                                <div class="skeleton-price"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        
        <!-- Preview Modal -->
        <div id="previewModal" class="preview-modal">
            <div class="preview-content">
                <div class="preview-header">
                    <h2 class="preview-title" id="previewTitle">Document Preview</h2>
                    <button class="preview-close" id="previewCloseBtn">Ã—</button>
                </div>
                <div id="previewBody" class="preview-body">
                    <!-- Preview content will be loaded here -->
                </div>
                <div id="previewActions" class="preview-actions">
                    <!-- Action buttons will be added here -->
                </div>
            </div>
        </div>


        <!-- Reviews Overlay -->
        <div class="reviews-overlay" id="reviewsOverlay">
            <div class="reviews-overlay-content">
                <div class="reviews-overlay-header">
                    <h2>
                        <span class="material-symbols-outlined">rate_review</span>
                        Recensioni
                    </h2>
                    <button class="close-overlay-btn" data-action="close-reviews">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
                
                <div class="reviews-overlay-body">
                    <div class="reviews-summary">
                        <div class="overall-rating">
                            <div class="rating-display">
                                <div class="big-stars"></div>
                                <span class="big-rating-score">0.0</span>
                            </div>
                            <span class="total-reviews">Basato su 0 recensioni</span>
                        </div>
                        <button class="add-review-btn" data-action="show-review-form">
                            <span class="material-symbols-outlined">add</span>
                            Aggiungi Recensione
                        </button>
                    </div>
                    
                    <div class="reviews-list" id="reviewsList">
                        <!-- Reviews will be populated here -->
                    </div>
                    
                    <div class="add-review-form" id="addReviewForm" style="display: none;">
                        <h3>Aggiungi la tua recensione</h3>
                        <fieldset class="rating-input">
                            <legend>Valutazione:</legend>
                            <div class="star-rating" role="group" aria-label="Seleziona valutazione">
                                <span class="star-input" data-rating="1" role="button" tabindex="0" aria-label="1 stella">â˜…</span>
                                <span class="star-input" data-rating="2" role="button" tabindex="0" aria-label="2 stelle">â˜…</span>
                                <span class="star-input" data-rating="3" role="button" tabindex="0" aria-label="3 stelle">â˜…</span>
                                <span class="star-input" data-rating="4" role="button" tabindex="0" aria-label="4 stelle">â˜…</span>
                                <span class="star-input" data-rating="5" role="button" tabindex="0" aria-label="5 stelle">â˜…</span>
                            </div>
                        </fieldset>
                        <div class="review-text-input">
                            <label for="reviewComment">Commento:</label>
                            <textarea id="reviewComment" placeholder="Condividi la tua esperienza con questo documento..." rows="4"></textarea>
                        </div>
                        <div class="review-form-actions">
                            <button class="cancel-review-btn" data-action="hide-review-form">Annulla</button>
                            <button class="submit-review-btn" data-action="submit-review">Invia Recensione</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Advanced Filters Panel (moved outside main for proper fixed positioning) -->
    <div class="filters-panel" id="filtersPanel">
        <div class="filters-content">
            <div class="filters-header">
                <div class="filters-header-top">
                <div class="filters-title">
                    <h2>ðŸŽ¯ Filtri</h2>
                </div>
                <div class="filters-actions">
                    <button class="filter-clear-btn" id="clearAllFilters">
                        <i class="material-symbols-outlined">clear_all</i>
                        Reset
                    </button>
                    <button class="filters-close" id="filtersClose">
                        <i class="material-symbols-outlined">close</i>
                    </button>
                </div>
                </div>
                <div class="filters-header-bottom">
                <div class="filters-subtitle">Trova esattamente quello che cerchi</div>
                </div>
            </div>

            <div class="filters-grid">
                <!-- Academic Context Section -->
                <div class="filter-section">
                    <h3 class="filter-section-title">
                        <i class="material-symbols-outlined">school</i>
                        Contesto Accademico
                    </h3>
                    <div class="filter-group">
                        <div class="filter-item">
                            <label for="facultyFilter" class="filter-label">FacoltÃ </label>
                            <div class="dropdown-container" data-dropdown="faculty">
                                <div class="dropdown-input-wrapper">
                                    <input type="text" id="facultyFilter" class="dropdown-input" placeholder="Scrivi o scegli una facoltÃ ...">
                                    <i class="material-symbols-outlined dropdown-arrow">expand_more</i>
                                </div>
                                <div class="dropdown-content" id="facultyDropdown">
                                    <div class="dropdown-options" id="facultyOptions"></div>
                                </div>
                            </div>
                        </div>
                        <div class="filter-item">
                            <label for="courseFilter" class="filter-label">Corso</label>
                            <div class="dropdown-container" data-dropdown="course">
                                <div class="dropdown-input-wrapper">
                                    <input type="text" id="courseFilter" class="dropdown-input" placeholder="Scrivi o scegli un corso...">
                                    <i class="material-symbols-outlined dropdown-arrow">expand_more</i>
                                </div>
                                <div class="dropdown-content" id="courseDropdown">
                                    <div class="dropdown-options" id="courseOptions"></div>
                                </div>
                            </div>
                        </div>
                        <div class="filter-item">
                            <label for="canaleFilter" class="filter-label">Canale</label>
                            <div class="dropdown-container" data-dropdown="canale">
                                <div class="dropdown-input-wrapper">
                                    <input type="text" id="canaleFilter" class="dropdown-input" placeholder="Scrivi o scegli un canale...">
                                    <i class="material-symbols-outlined dropdown-arrow">expand_more</i>
                                </div>
                                <div class="dropdown-content" id="canaleDropdown">
                                    <div class="dropdown-options" id="canaleOptions"></div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Document Properties Section -->
                <div class="filter-section">
                    <h3 class="filter-section-title">
                        <i class="material-symbols-outlined">description</i>
                        Tipologia Documento
                    </h3>
                    <div class="filter-group">
                        <div class="filter-item">
                            <label for="tagFilter" class="filter-label">Tipo Documento</label>
                            <div class="dropdown-container" data-dropdown="tag">
                                <div class="dropdown-input-wrapper">
                                    <input type="text" id="tagFilter" class="dropdown-input" placeholder="Tutti i tipi" readonly>
                                    <i class="material-symbols-outlined dropdown-arrow">expand_more</i>
                                </div>
                                <div class="dropdown-content" id="tagDropdown">
                                    <div class="dropdown-options" id="tagOptions"></div>
                                </div>
                            </div>
                        </div>
                        <div class="filter-item">
                            <label for="documentTypeFilter" class="filter-label">Formato file</label>
                            <div class="dropdown-container" data-dropdown="documentType">
                                <div class="dropdown-input-wrapper">
                                    <input type="text" id="documentTypeFilter" class="dropdown-input" placeholder="Tutti i formati" readonly>
                                    <i class="material-symbols-outlined dropdown-arrow">expand_more</i>
                                </div>
                                <div class="dropdown-content" id="documentTypeDropdown">
                                    <div class="dropdown-options" id="documentTypeOptions"></div>
                                </div>
                            </div>
                        </div>
                        <div class="filter-item">
                            <label for="languageFilter" class="filter-label">Lingua</label>
                            <div class="dropdown-container" data-dropdown="language">
                                <div class="dropdown-input-wrapper">
                                    <input type="text" id="languageFilter" class="dropdown-input" placeholder="Tutte le lingue" readonly>
                                    <i class="material-symbols-outlined dropdown-arrow">expand_more</i>
                                </div>
                                <div class="dropdown-content" id="languageDropdown">
                                    <div class="dropdown-options" id="languageOptions"></div>
                                </div>
                            </div>
                        </div>
                        <fieldset class="filter-item">
                            <legend class="filter-label">Tipo Vetrina</legend>
                            <div class="vetrina-toggle-group" role="group" aria-label="Seleziona tipo vetrina">
                                <button class="vetrina-toggle active" data-vetrina="all">
                                    <i class="material-symbols-outlined">select_all</i>
                                    Tutte
                                </button>
                                <button class="vetrina-toggle" data-vetrina="single">
                                    <i class="material-symbols-outlined">description</i>
                                    Singolo File
                                </button>
                                <button class="vetrina-toggle" data-vetrina="multiple">
                                    <i class="material-symbols-outlined">folder</i>
                                    Pacchetti
                                </button>
                            </div>
                        </fieldset>
                        <!-- Pagine Filter -->
                        <div class="filter-item" id="pagesRangeContainer">
                            <label class="filter-label" for="minPagesRange">Numero di Pagine</label>
                            <div class="pages-range-filter">
                                <div class="dual-range-container">
                                    <div class="range-track">
                                        <div class="range-fill" id="pagesRangeFill"></div>
                                    </div>
                                    <input type="range" id="minPagesRange" class="range-slider range-slider-min" min="1" max="1000" value="1" step="1" aria-label="Numero minimo di pagine">
                                    <input type="range" id="maxPagesRange" class="range-slider range-slider-max" min="1" max="1000" value="1000" step="1" aria-label="Numero massimo di pagine">
                                </div>
                                <div class="range-values">
                                    <span id="minPagesValue" class="editable-value" data-type="pages" data-position="min" data-tooltip="Clicca per modificare">1</span><span id="maxPagesValue" class="editable-value" data-type="pages" data-position="max" data-tooltip="Clicca per modificare">1000</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Academic Period Section -->
                <div class="filter-section">
                    <h3 class="filter-section-title">
                        <i class="material-symbols-outlined">calendar_month</i>
                        Periodo Accademico
                    </h3>
                    <div class="filter-group">
                        <div class="filter-item">
                            <label for="academicYearFilter" class="filter-label">Anno Accademico</label>
                            <div class="dropdown-container" data-dropdown="academicYear">
                                <div class="dropdown-input-wrapper">
                                    <input type="text" id="academicYearFilter" class="dropdown-input" placeholder="Tutti gli anni" readonly>
                                    <i class="material-symbols-outlined dropdown-arrow">expand_more</i>
                                </div>
                                <div class="dropdown-content" id="academicYearDropdown">
                                    <div class="dropdown-options" id="academicYearOptions"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quality & Engagement Section -->
                <div class="filter-section">
                    <h3 class="filter-section-title">
                        <i class="material-symbols-outlined">star</i>
                        QualitÃ  & Engagement
                    </h3>
                    <div class="filter-group">
                        <fieldset class="filter-item">
                            <legend class="filter-label">Rating Minimo</legend>
                            <div class="rating-filter">
                                <div class="rating-stars-filter" role="group" aria-label="Seleziona rating minimo">
                                    <span class="rating-star-filter" data-rating="1" role="button" tabindex="0" aria-label="Rating minimo 1 stella">â˜…</span>
                                    <span class="rating-star-filter" data-rating="2" role="button" tabindex="0" aria-label="Rating minimo 2 stelle">â˜…</span>
                                    <span class="rating-star-filter" data-rating="3" role="button" tabindex="0" aria-label="Rating minimo 3 stelle">â˜…</span>
                                    <span class="rating-star-filter" data-rating="4" role="button" tabindex="0" aria-label="Rating minimo 4 stelle">â˜…</span>
                                    <span class="rating-star-filter" data-rating="5" role="button" tabindex="0" aria-label="Rating minimo 5 stelle">â˜…</span>
                                </div>
                                <span class="rating-text" id="ratingText">Qualsiasi rating</span>
                            </div>
                        </fieldset>
                    </div>
                </div>

                <!-- Price & Availability Section -->
                <div class="filter-section">
                    <h3 class="filter-section-title">
                        <i class="material-symbols-outlined">payments</i>
                        Prezzo & DisponibilitÃ 
                    </h3>
                    <div class="filter-group">
                        <fieldset class="filter-item">
                            <legend class="filter-label">Prezzo</legend>
                            <div class="price-toggle-group" role="group" aria-label="Seleziona filtro prezzo">
                                <button class="price-toggle active" data-price="all">
                                    <i class="material-symbols-outlined">select_all</i>
                                    Tutti
                                </button>
                                <button class="price-toggle" data-price="free">
                                    <i class="material-symbols-outlined">volunteer_activism</i>
                                    Gratis
                                </button>
                                <button class="price-toggle" data-price="paid">
                                    <i class="material-symbols-outlined">paid</i>
                                    A Pagamento
                                </button>
                            </div>
                        </fieldset>
                        <div class="filter-item" id="priceRangeContainer">
                            <label class="filter-label" for="minPriceRange">Range di Prezzo (â‚¬)</label>
                            <div class="price-range-filter">
                                <div class="dual-range-container">
                                    <div class="range-track">
                                        <div class="range-fill" id="rangeFill"></div>
                                    </div>
                                    <input type="range" id="minPriceRange" class="range-slider range-slider-min" min="0" max="100" value="0" step="0.5" aria-label="Prezzo minimo in euro">
                                    <input type="range" id="maxPriceRange" class="range-slider range-slider-max" min="0" max="100" value="100" step="0.5" aria-label="Prezzo massimo in euro">
                                </div>
                                <div class="price-values">
                                    <span id="minPriceValue" class="editable-value" data-type="price" data-position="min" data-tooltip="Clicca per modificare">â‚¬0</span>
                                    <span id="maxPriceValue" class="editable-value" data-type="price" data-position="max" data-tooltip="Clicca per modificare">â‚¬100</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


            </div>
        </div>
    </div>

    <!-- Filters Overlay -->
    <div class="filters-overlay" id="filtersOverlay"></div>

    <!-- Preview Modal -->
    <div id="previewModal" class="preview-modal">
        <div class="preview-content">
            <div class="preview-header">
                <h2 class="preview-title" id="previewTitle">Document Preview</h2>
                <button class="preview-close" id="previewCloseBtn">Ã—</button>
            </div>
            <div id="previewBody" class="preview-body">
                <!-- Preview content will be loaded here -->
            </div>
            <div id="previewActions" class="preview-actions">
                <!-- Action buttons will be added here -->
            </div>
        </div>
    </div>

    <!-- Scroll to Top Button -->
    <button class="scroll-to-top-btn" id="scrollToTopBtn" aria-label="Scroll to top of page">
        <i class="material-symbols-outlined">keyboard_arrow_up</i>
    </button>

    <!-- Reviews Overlay -->
    <div class="reviews-overlay" id="reviewsOverlay">
        <div class="reviews-overlay-content">
            <div class="reviews-overlay-header">
                <h2>
                    <span class="material-symbols-outlined">rate_review</span>
                    Recensioni
                </h2>
                <button class="close-overlay-btn" data-action="close-reviews">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            
            <div class="reviews-overlay-body">
                <div class="reviews-summary">
                    <div class="overall-rating">
                        <div class="rating-display">
                            <div class="big-stars"></div>
                            <span class="big-rating-score">0.0</span>
                        </div>
                        <span class="total-reviews">Basato su 0 recensioni</span>
                    </div>
                    <button class="add-review-btn" data-action="show-review-form">
                        <span class="material-symbols-outlined">add</span>
                        Aggiungi Recensione
                    </button>
                </div>
                
                <div class="reviews-list" id="reviewsList">
                    <!-- Reviews will be populated here -->
                </div>
                
                <div class="add-review-form" id="addReviewForm" style="display: none;">
                    <h3>Aggiungi la tua recensione</h3>
                    <fieldset class="rating-input">
                        <legend>Valutazione:</legend>
                        <div class="star-rating" role="group" aria-label="Seleziona valutazione">
                            <span class="star-input" data-rating="1" role="button" tabindex="0" aria-label="1 stella">â˜…</span>
                            <span class="star-input" data-rating="2" role="button" tabindex="0" aria-label="2 stelle">â˜…</span>
                            <span class="star-input" data-rating="3" role="button" tabindex="0" aria-label="3 stelle">â˜…</span>
                            <span class="star-input" data-rating="4" role="button" tabindex="0" aria-label="4 stelle">â˜…</span>
                            <span class="star-input" data-rating="5" role="button" tabindex="0" aria-label="5 stelle">â˜…</span>
                        </div>
                    </fieldset>
                    <div class="review-text-input">
                        <label for="reviewComment2">Commento:</label>
                        <textarea id="reviewComment2" placeholder="Condividi la tua esperienza con questo documento..." rows="4"></textarea>
                    </div>
                    <div class="review-form-actions">
                        <button class="cancel-review-btn" data-action="hide-review-form">Annulla</button>
                        <button class="submit-review-btn" data-action="submit-review">Invia Recensione</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Professional Performance & Caching System -->
    <script src="js/config.js" defer></script>
    <script src="js/performance-cache.js" defer></script>
    <script src="js/memory-management.js" defer></script>
    <!-- Components now inline - only load JavaScript for functionality -->
    <script src="components/header/header.js" defer></script>
    <script src="components/search-section/search-component.js"></script>
    <script>
        // Additional script to ensure clean redirects
        window.addEventListener('beforeunload', function() {
            // Clean up any potential redirect conflicts
        });
    </script>
    <script>
        // Initialize components when DOM is ready - no fetch delays
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize header component
            if (typeof initializeHeader === 'function') {
                initializeHeader();
            }
            
            // Initialize search component  
            if (typeof initializeSearchComponent === 'function') {
                initializeSearchComponent();
            }
            
            console.log('âœ… All components initialized instantly');
        });
    </script>
    <script src="js/search.js" defer></script>
    
</body>
</html>